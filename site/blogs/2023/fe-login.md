# 前端登录知多少

当我们日常访问网页或者网站应用时，一旦涉及到权限问题就需要我们进行登录验证，同时在登录成功后还能在很长一段时间保持这个登录的状态，而不需要二次登录。所以这是怎么做到的呢？



## 登录态实现原理

### 根因

一切的起源在于当我们把用户名密码提交给服务端后，看似让服务端“认识”了我们，但是当下一次发起客户端请求时，服务端又不知道这是谁了。 其中根本的原因就是**HTTP是无状态的**。即HTTP请求A是无法一个所谓的“登录状态”继承给HTTP请求B的



### 解决方案

所以这个解决方案的**核心**就是**存储**，如果把登录的信息存储在客户端，好让每次请求都带上它，让服务端认得自己

#### 方案1

直观的看，最容易想到的方法就是，能不能每次请求都把账号名+密码带在请求体中，这样等于每次请求都可以验证自己的身份了。但这样的问题会非常多

- 需要由浏览器去托管我们的账号密码，有泄露的风险
- 每次请求都校验身份，效率很低
- 浏览器本身并没有这个功能（每次请求通过浏览器注入参数）

所以这是一个实际上并没有存在过的方案



#### 方案2

通过上个方案，我们的思路就是想怎么在浏览器里存信息，同时能让请求带上它。这里就要引出**cookie**

cookie简单的说就是一系列存储在浏览器上的键值对，它有几个主要的信息

- Name和Value，也就是Key和Value
- Domain：代表是由哪个域名注入的cookie，如果域名和当前访问网站一致就是一方cookie，否则就是三方cookie。
- Expires： 过期时间，过了这个时间这个cookie就会自动被删除

![image-20230911105242003](https://kuimo-markdown-pic.oss-cn-hangzhou.aliyuncs.com/image-20230911105242003.png)

cookie是通过服务端的返回，一般是类似login的接口的成功返回中，在Response Header中添加了一个叫做**Set-Cookie**的头，里面的内容就是一个键值对的字符串，这里一般就是用户相关的登录信息了

<img src="https://kuimo-markdown-pic.oss-cn-hangzhou.aliyuncs.com/image-20230911110046549.png" alt="image-20230911110046549" style="zoom:67%;" />

接下来就是cookie最强大的功能了，在每次XHR请求中，它都会自动把当前域的cookie带上，放在请求头中的Cookie字段里面（跨域情况除外），这样每次访问服务端就会自动带上由服务端上次Set给客户端的用户登录信息，所以就能做到登录状态保持了

![image-20230911110331908](https://kuimo-markdown-pic.oss-cn-hangzhou.aliyuncs.com/image-20230911110331908.png)



但这里会有一个问题，即服务端在set-cookie中应该放什么内容让客户端存储呢？ 假设我们延续了方案1的思路，在Cookie中放入账号名和密码，理论上是解决了登录保持的问题，但上面提到的风险隐患依然存在



#### 方案3

Session + Cookie


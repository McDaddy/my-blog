---
title: 不定期更新的有意思的面试题
date: 2020-05-25
tags:
 - 面试
categories:
 - 工具
---

这是一个随时保存刷到好题的地方

<!-- more -->

## 遍历list同步异步问题

问题：写出下面的输出

```javascript
let list = [1, 2, 3]
let square = num => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve(num * num)
    }, 1000)
  })
}

function test() {
  list.forEach(async x => {
    const res = await square(x)
    console.log(res)
  })
}
test()
```

结果是一秒后输出`1 4 9`, 如果想每隔一秒输出一行怎么改，且不能改square

```javascript
async function test() {
  for(let i of list) {
    const res = await square(x)
    console.log(res)
  }
}
test()
```

为什么list.forEach不能同步执行呢？可以看到它的实现，本质上它只是执行了这个callback但是完全没有await，所以就直接略过了

```javascript
Array.prototype.forEach = function (callback) {
  // this represents our array
  for (let index = 0; index < this.length; index++) {
    // We call the callback for each entry
    callback(this[index], index, this);
  }
};
```

总结：`list.forEach/map`等都是异步执行函数的，但使用`for…of/in`就可以同步执行

[参考](https://stackoverflow.com/questions/37576685/using-async-await-with-a-foreach-loop)

[JavaScript: async/await with forEach()](https://codeburst.io/javascript-async-await-with-foreach-b6ba62bbf404)

